# pis-on-trains (仮称)

![Godot Engine](https://img.shields.io/badge/Godot-v4.x-478cbf?logo=godotengine&logoColor=white)
![C#](https://img.shields.io/badge/Language-C%23-239120?logo=csharp&logoColor=white)

**反射神経と精密性。迫りくる列車を選別する2Dクリックアクションゲーム。**

## 🎮 概要
画面左右から流れてくる列車に対し、瞬時の判断でクリックを行うシンプルなアクションゲームです。「クリックのみ」という直感的な操作性ながら、時間の経過とともに加速するゲームスピードと、動的に変化する出現密度により、高い没入感と緊張感を提供します。

**主な特徴:**
* **ワンクリック操作:** マウスのみで完結するシンプルなUI/UX。
* **動的な難易度調整:** プレイ時間に応じて列車速度とスポーン頻度がリニアに上昇。
* **視覚的なフィードバック:** シェーダーを用いたグレースケール化による、即時かつ小気味よい操作フィードバック。

## 🕹️ 操作方法・ルール
* **操作:** 画面上の列車を **左クリック** します。
* **ルール:**
    * 🔴 **正解の列車（赤・青・紫）:** クリックするとスコア加算＆制限時間延長。
    * ⚫ **ダミーの列車（黒）:** クリックするとペナルティ（残り時間減少）。
    * 画面外に逃すとスコアにはなりませんが、ペナルティはありません。
    * 制限時間が0になるとゲームオーバーです。

## 🛠️ 技術的なこだわり
本プロジェクトでは、単に動くものを作るだけでなく、**「拡張性」**と**「ゲームフィードバック（手触り）」**を重視して設計しました。

### 1. 距離ベースのスポーン制御アルゴリズム
ゲームの進行に合わせて列車の移動速度が変化するため、単純な「時間経過（Timer）」による列車のスポーンでは、速度上昇時に車間距離が開きすぎてしまう問題がありました。
そこで、**「前回の車両からの物理的な距離」を監視するポーリング方式**を採用しました。

* **課題:** 速度倍率が変化しても、一定の密度（わちゃわちゃ感）を保ちたい。
* **解決策:** 各レーンの最終スポーン位置を監視し、速度に関わらず「指定ピクセル以上離れたら次を生成可能」とするロジックを実装。
* **応用:** この仕組みにより、特定の条件下で必要距離を極端に短くすることで、「連結車両」のような表現も確率で発生させることを可能にしています。

### 2. 即時フィードバックとオブジェクト管理
クリック時の爽快感を損なわないよう、判定処理と演出を工夫しています。

* **「幽霊電車」化ロジック:**
    クリック直後に `QueueFree()`（削除）してしまうと、スポーナーが「空きができた」と誤認し、即座に次の列車を生成してしまう問題がありました。
    これを防ぐため、クリック時は**「当たり判定の無効化」と「シェーダーによるグレースケール化（視覚的な無効化）」のみ**を行い、オブジェクト自体は画面外に出るまで走らせ続ける設計にしました。これにより、自然な生成リズムを維持しています。
* **シェーダー活用:**
    テクスチャの差し替えではなく、GDShaderを用いて動的にグレースケール変換を行うことで、リソースを節約しつつリッチな表現を実現しました。

### 3. 設計パターン
* **Singletonパターン:** `GameScene` にシングルトンを適用し、スコアや難易度係数（SpeedMultiplier）へ、各列車インスタンスから容易にアクセスできる設計にしました。
* **Event駆動:** `Timer` のタイムアウトや `InputEvent` シグナルを活用し、疎結合な設計を意識しました。

## 💻 開発環境
* **Engine:** Godot Engine 4.x (.NET module)
* **Language:** C#
* **IDE:** Visual Studio / VS Code

## 📂 ディレクトリ構成（抜粋）
```text
res://
├── scenes/
│   ├── GameScene.tscn   # メインゲームループとUI管理
│   ├── Spawner.tscn     # 生成ロジックとレーン管理
│   └── Train.tscn       # 列車オブジェクト（移動・クリック判定）
├── scripts/
│   ├── GameScene.cs     # スコア・時間・難易度の統括
│   ├── Spawner.cs       # 距離ベースのスポーン制御アルゴリズム
│   └── Train.cs         # 個別の振る舞いとシェーダー制御
└── assets/              # 音声・画像素材
